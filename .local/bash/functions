#!/usr/bin/env bash

gac() { # git add commit -m $1
  args=("$@")
  message="${args[-1]}"

  if [ ! -e "$message" ]; then
    git add "${args[@]:0:${#args[@]}-1}" && git commit -m "$message"
  else
    echo "Missing commit message"
  fi
}

custom_cd() { # path shortcutting (specifically for alias builds)
  local base_dir="$1"
  shift

  if [ $# -eq 0 ]; then
    cd "$base_dir" || return
  else
    cd "$base_dir/$1" || return
  fi
}

zd() { # stock with omarchy
  if [ $# -eq 0 ]; then
    builtin cd ~ && return
  elif [ -d "$1" ]; then
    builtin cd "$1"
  else
    z "$@" && printf "\U000F17A9 " && pwd || echo "Error: Directory not found"
  fi
}

nginx-edit() {
  if [ -z "$1" ]; then
    echo "Usage: nginx-edit <site-name>"
    echo "Available sites:"
    ls /etc/nginx/sites-available/ 2>/dev/null | sed 's/^/  /'
    return 1
  fi

  local site_file="/etc/nginx/sites-available/$1"

  if [ ! -f "$site_file" ]; then
    echo "Error: $site_file does not exist"
    echo "Available sites:"
    ls /etc/nginx/sites-available/ 2>/dev/null | sed 's/^/  /'
    return 1
  fi

  echo "Editing nginx config for: $1"
  sudo /usr/bin/nvim/ +'set ft=nginx' "$site_file"

  read -p "Test nginx config and reload? [y/N] " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    sudo nginx -t && sudo systemctl reload nginx
  fi
}

_nginx_edit_completion() {
  local cur="${COMP_WORDS[COMP_CWORD]}"
  local -a sites
  mapfile -t sites < <(find /etc/nginx/sites-available/ -maxdepth 1 -type f -printf '%f\n' 2>/dev/null)
  COMPREPLY=($(compgen -W "${sites[*]}" -- "$cur"))
}

complete -F _nginx_edit_completion nginx-edit
